<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>平台用工连续劳务个税计算器</title>
  <style>
    :root {
      --bg: #fff4d6;
      --card: #ffffff;
      --ink: #1c1c1c;
      --muted: #6b6b6b;
      --accent: #ff7a00;
      --accent-2: #00b7ff;
      --accent-3: #7b61ff;
      --good: #11b36a;
      --bad: #ff4d4f;
      --shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      --radius: 18px;
      --radius-sm: 12px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "ZCOOL KuaiLe", "PingFang SC", "Microsoft YaHei", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 800px at 20% -10%, #ffe6a6 0%, transparent 60%),
        radial-gradient(900px 600px at 110% 20%, #c9f2ff 0%, transparent 55%),
        linear-gradient(180deg, #fff4d6 0%, #fffaf0 60%, #ffffff 100%);
      min-height: 100vh;
    }

    .page {
      width: 100%;
      max-width: 720px;
      margin: 0 auto;
      padding: 18px 16px 32px;
    }

    .hero {
      position: relative;
      background: var(--card);
      border-radius: var(--radius);
      padding: 18px 18px 20px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .hero::after {
      content: "";
      position: absolute;
      right: -50px;
      top: -40px;
      width: 160px;
      height: 160px;
      background: conic-gradient(from 180deg at 50% 50%, #ffd86b, #ff8a00, #ffd86b);
      border-radius: 50%;
      opacity: 0.65;
    }

    .title {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.5px;
      margin: 0 0 6px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--muted);
      margin: 0;
    }

    .stats {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .stat {
      background: #fff7ea;
      border-radius: var(--radius-sm);
      padding: 12px;
      border: 1px dashed #ffd087;
    }

    .stat h4 {
      margin: 0 0 6px;
      font-size: 12px;
      color: var(--muted);
    }

    .stat .value {
      font-size: 18px;
      font-weight: 700;
    }

    .table-card {
      margin-top: 16px;
      background: var(--card);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
    }

    .table-head {
      display: grid;
      grid-template-columns: 64px 1fr 1fr 1fr;
      gap: 8px;
      font-size: 12px;
      color: var(--muted);
      padding: 6px 6px 10px;
      border-bottom: 1px solid #f0f0f0;
    }

    .row {
      display: grid;
      grid-template-columns: 64px 1fr 1fr 1fr;
      gap: 8px;
      align-items: center;
      padding: 10px 6px;
      border-bottom: 1px dashed #f0f0f0;
    }

    .row:last-child {
      border-bottom: none;
    }

    .month-tag {
      font-size: 13px;
      font-weight: 700;
      color: #7a4b00;
      background: #ffe6a6;
      padding: 6px 8px;
      border-radius: 999px;
      text-align: center;
    }

    input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e7e7e7;
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      background: #fffefb;
    }

    input[type="number"]:focus {
      border-color: var(--accent-2);
      box-shadow: 0 0 0 3px rgba(0, 183, 255, 0.18);
    }

    .num {
      font-size: 13px;
      font-weight: 600;
      color: #2b2b2b;
    }

    .num.bad { color: var(--bad); }
    .num.good { color: var(--good); }

    .actions {
      margin-top: 16px;
      background: var(--card);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .actions .field {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }

    .actions button {
      border: none;
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      color: #fff;
      background: linear-gradient(135deg, #ff8a00, #ffb347);
      box-shadow: 0 8px 16px rgba(255, 138, 0, 0.25);
      transition: transform 0.1s ease;
    }

    .actions button.secondary {
      background: linear-gradient(135deg, #00b7ff, #68d7ff);
      box-shadow: 0 8px 16px rgba(0, 183, 255, 0.25);
    }

    .actions button.ghost {
      background: linear-gradient(135deg, #7b61ff, #a08bff);
      box-shadow: 0 8px 16px rgba(123, 97, 255, 0.25);
    }

    .actions button:active {
      transform: translateY(1px);
    }

    .note {
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
    }

    @media (max-width: 420px) {
      .table-head, .row {
        grid-template-columns: 54px 1fr 1fr 1fr;
      }
      .stat .value { font-size: 16px; }
    }

    @media (orientation: landscape) and (max-height: 520px) {
      .page {
        max-width: none;
        padding: 12px 12px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <section class="hero">
      <h1 class="title">平台用工连续劳务个税计算器</h1>
      <p class="subtitle">输入每月收入，自动计算当月应预扣预缴税额与税后收入。</p>
      <div class="stats">
        <div class="stat">
          <h4>总收入</h4>
          <div class="value" id="totalIncome">0</div>
        </div>
        <div class="stat">
          <h4>总税后收入</h4>
          <div class="value" id="totalAfter">0</div>
        </div>
        <div class="stat">
          <h4>总税额</h4>
          <div class="value" id="totalTax">0</div>
        </div>
        <div class="stat">
          <h4>平均税率</h4>
          <div class="value" id="avgRate">0%</div>
        </div>
      </div>
    </section>

    <section class="table-card">
      <div class="table-head">
        <div>月份</div>
        <div>当月收入</div>
        <div>当月预扣税额</div>
        <div>税后收入</div>
      </div>
      <div id="rows"></div>
    </section>

    <section class="actions">
      <div class="field">
        <input id="fixedIncome" type="number" min="0" step="0.01" placeholder="每月固定收入" />
        <button id="fillBtn" class="secondary">填充固定收入</button>
      </div>
      <button id="clearBtn" class="ghost">清空所有月份</button>
      <button id="sampleBtn">示例填充</button>
      <div class="note">提示：连续周期以“有收入的连续月份”为一段，出现空月则重置为新周期。</div>
    </section>
  </div>

  <script>
    const TAX_TABLE = [
      { max: 36000, rate: 0.03, deduction: 0 },
      { max: 144000, rate: 0.1, deduction: 2520 },
      { max: 300000, rate: 0.2, deduction: 16920 },
      { max: 420000, rate: 0.25, deduction: 31920 },
      { max: 660000, rate: 0.3, deduction: 52920 },
      { max: 960000, rate: 0.35, deduction: 85920 },
      { max: Infinity, rate: 0.45, deduction: 181920 }
    ];

    const rowsEl = document.getElementById("rows");
    const totalIncomeEl = document.getElementById("totalIncome");
    const totalAfterEl = document.getElementById("totalAfter");
    const totalTaxEl = document.getElementById("totalTax");
    const avgRateEl = document.getElementById("avgRate");

    const currency = (value) => {
      if (!Number.isFinite(value)) return "0";
      return new Intl.NumberFormat("zh-CN", {
        style: "currency",
        currency: "CNY",
        minimumFractionDigits: 2
      }).format(value);
    };

    const percent = (value) => `${(value * 100).toFixed(2)}%`;

    const createRows = () => {
      rowsEl.innerHTML = "";
      for (let i = 1; i <= 12; i += 1) {
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `
          <div class="month-tag">${i}月</div>
          <input type="number" min="0" step="0.01" data-month="${i}" placeholder="0.00" />
          <div class="num bad" data-tax="${i}">￥0.00</div>
          <div class="num good" data-after="${i}">￥0.00</div>
        `;
        rowsEl.appendChild(row);
      }
    };

    const getBracket = (base) => {
      for (const item of TAX_TABLE) {
        if (base <= item.max) return item;
      }
      return TAX_TABLE[TAX_TABLE.length - 1];
    };

    const compute = () => {
      const inputs = rowsEl.querySelectorAll("input[data-month]");
      let totalIncome = 0;
      let totalAfter = 0;
      let totalTax = 0;

      let cycleIncome = 0;
      let cycleTaxPaid = 0;
      let cycleMonths = 0;
      let prevHasIncome = false;

      inputs.forEach((input) => {
        const value = parseFloat(input.value);
        const income = Number.isFinite(value) ? value : 0;
        const month = input.dataset.month;
        const taxEl = rowsEl.querySelector(`[data-tax="${month}"]`);
        const afterEl = rowsEl.querySelector(`[data-after="${month}"]`);
        let tax = 0;
        let after = 0;

        if (income > 0) {
          if (!prevHasIncome) {
            cycleIncome = 0;
            cycleTaxPaid = 0;
            cycleMonths = 0;
          }

          cycleIncome += income;
          cycleMonths += 1;

          const cycleExpense = cycleIncome * 0.2;
          const cycleDeduction = cycleMonths * 5000;
          const base = cycleIncome - cycleExpense - cycleDeduction;

          if (base > 0) {
            const bracket = getBracket(base);
            tax = base * bracket.rate - bracket.deduction - cycleTaxPaid;
            if (tax < 0) tax = 0;
          }

          cycleTaxPaid += tax;

          after = income - tax;
          taxEl.textContent = currency(tax);
          afterEl.textContent = currency(after);
        } else {
          taxEl.textContent = currency(0);
          afterEl.textContent = currency(0);
        }

        totalIncome += income;
        totalTax += tax;
        totalAfter += after;

        prevHasIncome = income > 0;
      });

      totalIncomeEl.textContent = currency(totalIncome);
      totalTaxEl.textContent = currency(totalTax);
      totalAfterEl.textContent = currency(totalAfter);
      avgRateEl.textContent = totalIncome > 0 ? percent(totalTax / totalIncome) : "0%";
    };

    const fillFixed = () => {
      const value = parseFloat(document.getElementById("fixedIncome").value);
      const income = Number.isFinite(value) ? value : 0;
      rowsEl.querySelectorAll("input[data-month]").forEach((input) => {
        input.value = income > 0 ? income.toFixed(2) : "";
      });
      compute();
    };

    const clearAll = () => {
      rowsEl.querySelectorAll("input[data-month]").forEach((input) => {
        input.value = "";
      });
      compute();
    };

    const sampleFill = () => {
      const sample = [12000, 13000, 0, 15000, 15000, 15000, 0, 8000, 9000, 10000, 0, 12000];
      rowsEl.querySelectorAll("input[data-month]").forEach((input, index) => {
        const value = sample[index];
        input.value = value > 0 ? value.toFixed(2) : "";
      });
      compute();
    };

    createRows();
    compute();

    rowsEl.addEventListener("input", (event) => {
      if (event.target.matches("input[data-month]")) {
        compute();
      }
    });

    document.getElementById("fillBtn").addEventListener("click", fillFixed);
    document.getElementById("clearBtn").addEventListener("click", clearAll);
    document.getElementById("sampleBtn").addEventListener("click", sampleFill);
  </script>
</body>
</html>
